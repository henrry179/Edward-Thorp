## 可转债套利思想与 Edward Thorp 风格概览

本项目聚焦的策略，是以 Edward Thorp 早期可转债套利实践为代表的「**买入低估的可转换债券 + 动态 Delta 对冲做空股票**」的市场中性套利框架。

### 1. 策略出发点：从定价错误中获利，而不是押方向

- 标的股票价格 \(S_t\) 服从随机过程（通常假设为 GBM），短期内走势难以预测；
- 可转债是一种「债券 + 转股期权」的混合品种，其市场价格经常受到流动性、情绪、条款复杂度等影响而偏离理论公平价值；
- 通过构建严谨的定价模型，我们希望估算出可转债的「理论公允价值」：
  \[
  \text{CB}_t^{\text{fair}} = \text{BondFloor}_t + \text{OptionValue}_t \pm \text{条款调整}
  \]
- 当市场价格 \(\text{CB}_t^{\text{mkt}}\) 明显低于 \(\text{CB}_t^{\text{fair}}\) 且偏离具有统计显著性时，就存在「低估」机会。

策略核心思想：

- **多头腿**：买入被低估的可转债；
- **空头腿**：按 Delta 对冲比例卖空对应数量的标的股票；
- **目标**：使组合对 \(S_t\) 的一阶敏感度（Delta）接近 0，尽量消除大盘涨跌等方向性风险，令收益主要来自错定价的收敛。

### 2. 可转债的结构分解

在严格定价视角下，可转债通常被分解为：

1. **纯债部分（Bond Floor）**
   - 定义：假设投资者永远不行使转换权，只按照债券条款收取票息并在到期收回本金；
   - 在存在信用风险的情况下，折现率通常为「无风险利率 + 信用利差」；
   - 数学形式：
     \[
     \text{BondFloor}_t = \sum_{k} \frac{C_k}{(1 + r_k + s_k)^{\tau_k}} + \frac{N}{(1 + r_T + s_T)^{T-t}}
     \]
     其中 \(C_k\) 为票息现金流、\(N\) 为票面、\(r_k\) 为相应期限利率、\(s_k\) 为信用利差。

2. **转股期权部分（Conversion Option）**
   - 定义：在一定条件下，持有人有权按固定转换比例将债券转换为股票；
   - 本质上是一个带有信用风险、路径依赖（赎回 / 回售条款）的「嵌入式美式看涨期权」；
   - 常见做法是利用二叉树 / 三叉树或有限差分方法，在风险中性测度下做折现求值。

3. **赎回 / 回售 / 重置条款**
   - 发行人赎回（Call）、投资人回售（Put）、转换价格重置（Reset）等条款，会改变可转债在不同节点的最优决策；
   - 在数值上通常体现在：在树上每个节点，对「继续持有」「立即转股」「被赎回 / 回售」等价值进行比较并取最大值。

### 3. 风险中性定价与二叉树方法的核心思路

在风险中性世界中，折现后的资产价格过程是鞅，这为数值定价提供了统一框架：

- 假设标的股票价格在短时间步长 \(\Delta t\) 内只可能「上涨」或「下跌」：
  \[
  S_{t+\Delta t} =
  \begin{cases}
    S_t u, & \text{概率 } p, \\
    S_t d, & \text{概率 } 1-p,
  \end{cases}
  \]
  其中 \(u = e^{\sigma \sqrt{\Delta t}}\)、\(d = 1/u\)；
- 令无风险利率为 \(r\)、股利率为 \(q\)，在风险中性测度下有：
  \[
  \mathbb{E}^{\mathbb{Q}}[S_{t+\Delta t} \mid S_t] = S_t e^{(r - q)\Delta t}
  \]
  从而得到风险中性概率：
  \[
  p = \frac{e^{(r - q)\Delta t} - d}{u - d}
  \]
- 对任何衍生品或可转债价值 \(V_t\)，在节点上满足：
  \[
  V_t = e^{-(r + s)\Delta t}\left( p V_u + (1-p) V_d \right)
  \]
  其中 \(s\) 为信用利差近似。

对于可转债：

- 终端节点（到期）价值为：\(\max\{\text{面值+最后票息}, \text{转股价值}, \text{赎回/回售价}\}\)；
- 在非终端节点，自后向前递推时，每个节点的价值为：
  \[
  V_t = \max\left\{
     \underbrace{e^{-(r+s)\Delta t}(p V_u + (1-p) V_d) + \text{票息（如适用）}}_{\text{继续持有债券的期望价值}},
     \underbrace{\text{转股价值}}_{\text{立即转股}},
     \underbrace{\text{赎回价 / 回售价（如触发）}}_{\text{条款行权}}
  \right\}
  \]

### 4. Delta 与市场中性组合

在二叉树框架中，可转债对标的股票价格的一阶敏感度（Delta）可以通过有限差分获得：

\[
\Delta_{\text{CB}} \approx \frac{V_u - V_d}{S_u - S_d},
\]

其中 \(V_u, V_d\) 是下一个时间步在「股价向上 / 向下」对应节点上的可转债价值，\(S_u, S_d\) 为对应的股票价格。

当我们持有面值为 \(N_{\text{CB}}\) 的可转债时，总体 Delta 近似为：

\[
\Delta_{\text{portfolio}} \approx N_{\text{CB}} \cdot \Delta_{\text{CB}} - n_{\text{stock}} \cdot 1,
\]

其中 \(n_{\text{stock}}\) 为卖空的股票股数。  
令组合 Delta 接近 0，可得对冲头寸：

\[
n_{\text{stock}}^{\star} \approx N_{\text{CB}} \cdot \frac{\Delta_{\text{CB}}}{S_t}.
\]

这正是本项目 `DeltaHedger` 模块中实现的核心思想：  
**用严谨定价获得 Delta，用股票卖空对冲掉价格一阶风险，使得组合主要暴露在错定价收敛与波动之上。**

### 5. 本项目与 Edward Thorp 思路的关联

Edward Thorp 的贡献在于：

- 使用数学与概率论工具，将「看似模糊的套利直觉」形式化为明确的定价模型与对冲策略；
- 强调通过动态对冲来剥离市场方向性风险，使得收益主要来自定价错误和波动；
- 在实践中严格估计参数（波动率、相关性、信用风险等），并不断回测验证模型有效性。

本项目希望在开源环境下，以 Python + 数值方法的形式，尽可能忠实地重现这一思想路径：

1. 构建可转债的严谨定价模型（树模型 + 信用折现 + 条款处理）；
2. 从模型输出中提取 Delta，并构建市场中性组合；
3. 利用统计信号（错定价 Z-score）控制建仓和平仓；
4. 通过回测与敏感性分析，检验策略在不同市场环境下的表现与风险。

